sudo: true
language: python
python:
  - "3.6"
  - "nightly"

env:
  - MOZ_HEADLESS=1

addons:
  firefox: latest

install:
  - pip install -r requirements/dev.txt

before_install:
  - wget https://github.com/mozilla/geckodriver/releases/download/v0.24.0/geckodriver-v0.24.0-linux64.tar.gz
  - mkdir geckodriver
  - tar -xzf geckodriver-v0.24.0-linux64.tar.gz -C geckodriver
  - sudo chmod +x $PWD/geckodriver/geckodriver
  - export PATH=$PATH:$PWD/geckodriver

script:
  - nosetests --with-cov --cov-config .coveragerc --cov ci_demo tests/

after_success:
  - codecov
jobs:
  include:
    - stage: Deploy
      script: skip
      deploy:
        provider: heroku
        api_key:
          secure: XmxoUjO7FgDzRxAWwnoET4sark+pSld6NbAnZwULEwa01hZKB09zIEUP/PSAkmEyjC4D8MLKFGb+gRve9H8ogh7HRzCOuUQRBUD0I04B+TNG836/BPTuJ3KGeIvoIGU/072wW3olq1tBJn9fLr4C8NN3fLcw5gGxd5jGXXFfxzEKX4sV1xBhzEBVBkFkj0BnBjxiqPJ0Syp+cGiw087Ee/BY19mGF+IU98G8IJytpe65u3opvSlpLlFyN80LaKyPideSx6IrJZFGeweHoniQEL7IbjkC93No6LaqEVCpkaDsHuJX50nOscP752ISaROrVNhfwRfoF0wDYVxYP+4kI9hLlD4e1PSQjdDm1CIK5sQiCGr7WBJEWrK4uMML6uPxWyFoR0dL9aEuYDE/jY268E/HGtU+6pnsS+FmVwykBw0sW18JDDi/mGLgGrFa10qBH/IXALIs0UObYycfiQSdZ2IJfg7Dj+Q+vguivrE7O+PaIiKeVR6Qr13HtwlDSTFrEa4ZBrwVZTCBUk6sSZV7seuEeZaMDqWanZPpFP0xpxfbI1AFjW+17LPchwQUHjqfwSaa4RdpgkOQRoHJ/ojMFgjaQjZNXkjnxxx7eVcV0lE6e0IdmgxrlLhkrQxbWY9C0OtTHBvNQ3PmTUD/xvQ3fJUIEKAky6lAZojpuGPyvUE=
        app: ci-workshop-rom
        on:
          repo: rohubert/ci_workshop
