sudo: true
language: python
python:
  - "3.6"
  - "nightly"

env:
  - MOZ_HEADLESS=1

addons:
  firefox: latest

install:
  - pip install -r requirements/dev.txt

before_install:
  - wget https://github.com/mozilla/geckodriver/releases/download/v0.24.0/geckodriver-v0.24.0-linux64.tar.gz
  - mkdir geckodriver
  - tar -xzf geckodriver-v0.24.0-linux64.tar.gz -C geckodriver
  - sudo chmod +x $PWD/geckodriver/geckodriver
  - export PATH=$PATH:$PWD/geckodriver

script:
  - nosetests --with-cov --cov-config .coveragerc --cov ci_demo tests/

after_success:
  - codecov
jobs:
  include:
    - stage: Deploy
      script: skip
      deploy:
        provider: heroku
        api_key:
          secure: x3QF+qtooKpDRH8ekOgYfeYXZ0auv2g2xfkNq9+DhCufVgN3UA+SykG1bCVBYQWyr08efQGKkq3TH1jLnWeDCyaGGtZPdnuvmPVoxDysGqUP4b77e66vvM3GekXm0Ea1XLYMgtfBC7MGE+HvE+zhzG7P0QWAm8WGmoCsM1l+nuboIkzWV9T2XvwFWnP4J8r4yQ5Me8f6y7dB5y/R+Zz0+DXFQLsF1oroEDdutW+AxDly2dFKik5pC0GPiZqFYKwsHSDFchFD0PR/aJ7W1GBHFY6LRKeqBup2wCrFGiv8wTXs2UrELLZ1ANlzH7tAuWTiiRKDZCe5DW6+hudhFB557HUvkpczKnLG0prcFteyoSYkz5LF3yqixeGOSfPre5NCincilJiE/YEMvF+crHLsruPVG0uFMcRyKzwKcOuVbxSBUOu8/N8kLIHExV0FEp1iJ1KcBFOLTvtWMVLBLfe1majeUgRfvnwU2uijGzG6S+zBpqqTFtQbrV3VxcGSwcLiDjxY8PmXnmWlu6EyqE3yRxeIZpMYorKxTiQkjeowABi7bnPwqigYdxyk/g51WOw3wzqTQY3TvLsAzrJYF2xyRWJZN/rRti00igQrV9662tHYCmGQtOkrn8wV+dWcmOKk4Z813Qk9HvdPrdceM63cpB6qXKUS7mLQvZXSNozF1Z4=
          app: ci-workshop-rom
        on:
          repo: rohubert/ci_workshop
